<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme" content="hugo-academic">
  <meta name="generator" content="Hugo 0.51" />
  <meta name="author" content="Matthew Leonawicz">
  <meta name="description" content="R Developer | Data Scientist | Statistician">

  
  
  
    
  
  
    
    
    <link rel="stylesheet" href="../../css/highlight.min.css">
    
  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha512-6MXa8B6uaO18Hid6blRMetEIoPqHf7Ux1tnyIQdpt9qI5OACx7C+O3IVTr98vwGnlcg0LOLa02i9Y1HpVhlfiw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.1/css/academicons.min.css" integrity="sha512-NThgw3XKQ1absAahW6to7Ey42uycrVvfNfyjqcFNgCmOCQ5AR4AO0SiXrN+8ZtYeappp56lk1WtvjVmEa+VR6A==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha512-SfTiTlX6kk+qitfevl/7LibUOeJWlt9rbyDn92a1DqWOw9vWG2MFoays0sgObmWazO5BQPiFucnnEAjpAB+/Sw==" crossorigin="anonymous">
  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather%7CRoboto+Mono">
  <link rel="stylesheet" href="../../css/hugo-academic.css">
  
  <link rel="stylesheet" href="../../css/styles.css">
  

  
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-46129458-3', 'auto');
      ga('require', 'eventTracker');
      ga('require', 'outboundLinkTracker');
      ga('require', 'urlChangeTracker');
      ga('send', 'pageview');
    </script>
    <script async src="//www.google-analytics.com/analytics.js"></script>
    
    <script async src="https://cdnjs.cloudflare.com/ajax/libs/autotrack/2.4.1/autotrack.js" integrity="sha512-HUmooslVKj4m6OBu0OgzjXXr+QuFYy/k7eLI5jdeEy/F4RSgMn6XRWRGkFi5IFaFgy7uFTkegp3Z0XnJf3Jq+g==" crossorigin="anonymous"></script>
    
  

  <link rel="alternate" href="../../index.xml" type="application/rss+xml" title="Matthew Leonawicz | Blog: I think, therefore I R">
  <link rel="feed" href="../../index.xml" type="application/rss+xml" title="Matthew Leonawicz | Blog: I think, therefore I R">

  <link rel="icon" type="image/png" href="../../img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="../../img/apple-touch-icon.png">

  <link rel="canonical" href="../../post/epubr-0-6-0-cran-release/">

  

  <title>epubr 0.6.0 CRAN release | Matthew Leonawicz | Blog: I think, therefore I R</title>

</head>
<body id="top" data-spy="scroll" data-target="#navbar-main" data-offset="71">

<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../../">Matthew Leonawicz | Blog: I think, therefore I R</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav navbar-right">
        

        

        <li class="nav-item">
          <a href="https://leonawicz.github.io/">
            
            <span>Home</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="https://leonawicz.github.io/showcase/">
            
            <span>Showcase</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../#about">
            
            <span>About</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../#posts">
            
            <span>Posts</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="../../#contact">
            
            <span>Contact</span>
          </a>
        </li>

        
        

        
      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  <div class="article-container">
    <h1 itemprop="name">epubr 0.6.0 CRAN release</h1>
    

<div class="article-metadata">

  <span class="article-date">
    
    <time datetime="2019-01-11 00:00:00 &#43;0000 UTC" itemprop="datePublished">
      Jan 11, 2019
    </time>
  </span>

  
  
  
  <span class="article-categories">
    <i class="fa fa-folder"></i>
    
    <a href="../../categories/r">R</a
    >
    
  </span>
  
  

  
  
  
  <span class="article-tags">
    <i class="fa fa-tags"></i>
    
    <a href="../../tags/code">code</a
    >, 
    
    <a href="../../tags/package">package</a
    >, 
    
    <a href="../../tags/cran">CRAN</a
    >, 
    
    <a href="../../tags/epub">epub</a
    >, 
    
    <a href="../../tags/text-mining">text mining</a
    >, 
    
    <a href="../../tags/e-books">e-books</a
    >
    
  </span>
  
  

  
  
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=%2fpost%2fepubr-0-6-0-cran-release%2f"
         target="_blank">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=epubr%200.6.0%20CRAN%20release&amp;url=%2fpost%2fepubr-0-6-0-cran-release%2f"
         target="_blank">
        <i class="fa fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2fpost%2fepubr-0-6-0-cran-release%2f&amp;title=epubr%200.6.0%20CRAN%20release"
         target="_blank">
        <i class="fa fa-linkedin"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=%2fpost%2fepubr-0-6-0-cran-release%2f&amp;title=epubr%200.6.0%20CRAN%20release"
         target="_blank">
        <i class="fa fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=epubr%200.6.0%20CRAN%20release&amp;body=%2fpost%2fepubr-0-6-0-cran-release%2f">
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


  

</div>

    <div class="article-style" itemprop="articleBody">
      


<p>The <a href="https://github.com/ropensci/epubr">epubr</a> R package provides functions supporting the reading and parsing of internal e-book content from EPUB files. It has been updated to v0.6.0 on CRAN. This post highlights new functionality. The key improvements focus on cases where EPUB files have poorly arranged text when loaded into R as a result of their metadata entries and archive file structure.</p>
<pre class="r"><code>library(epubr)
file &lt;- system.file(&quot;dracula.epub&quot;, package = &quot;epubr&quot;)
(x &lt;- epub(file))
#&gt; # A tibble: 1 x 9
#&gt;   rights  identifier   creator  title language subject date  source   data 
#&gt;   &lt;chr&gt;   &lt;chr&gt;        &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;lis&gt;
#&gt; 1 Public~ http://www.~ Bram St~ Drac~ en       Horror~ 1995~ http://~ &lt;tib~

x$data[[1]]
#&gt; # A tibble: 15 x 4
#&gt;    section        text                                          nword nchar
#&gt;    &lt;chr&gt;          &lt;chr&gt;                                         &lt;int&gt; &lt;int&gt;
#&gt;  1 item6          &quot;The Project Gutenberg EBook of Dracula, by ~ 11446 60972
#&gt;  2 item7          &quot;But I am not in heart to describe beauty, f~ 13879 71798
#&gt;  3 item8          &quot;\&quot; &#39;Lucy, you are an honest-hearted girl, I~ 12474 65522
#&gt;  4 item9          &quot;CHAPTER VIIIMINA MURRAY&#39;S JOURNAL\nSame day~ 12177 62724
#&gt;  5 item10         &quot;CHAPTER X\nLetter, Dr. Seward to Hon. Arthu~ 12806 66678
#&gt;  6 item11         &quot;Once again we went through that ghastly ope~ 12103 62949
#&gt;  7 item12         &quot;CHAPTER XIVMINA HARKER&#39;S JOURNAL\n23 Septem~ 12214 62234
#&gt;  8 item13         &quot;CHAPTER XVIDR. SEWARD&#39;S DIARY-continued\nIT~ 13990 72903
#&gt;  9 item14         &quot;\&quot;Thus when we find the habitation of this ~ 13356 69779
#&gt; 10 item15         &quot;\&quot;I see,\&quot; I said. \&quot;You want big things th~ 12866 66921
#&gt; 11 item16         &quot;CHAPTER XXIIIDR. SEWARD&#39;S DIARY\n3 October.~ 11928 61550
#&gt; 12 item17         &quot;CHAPTER XXVDR. SEWARD&#39;S DIARY\n11 October, ~ 13119 68564
#&gt; 13 item18         &quot; \nLater.-Dr. Van Helsing has returned. He ~  8435 43464
#&gt; 14 item19         &quot;End of the Project Gutenberg EBook of Dracu~  2665 18541
#&gt; 15 coverpage-wra~ &quot;&quot;                                                0     0</code></pre>
<div id="restructure-parsed-content" class="section level2">
<h2>Restructure parsed content</h2>
<p>When reading EPUB files it is ideal to be able to identify meaningful sections to retain via a regular expression pattern, as well as to drop extraneous sections in a similar manner. Using pattern matching as shown above is a convenient way to filter rows of the nested text content data frame.</p>
<p>For e-books with poor metadata formatting this is not always possible, or may be possible only after some other pre-processing. <code>epubr</code> provides other functions to assist in restructuring the text table. The Dracula EPUB file included in <code>epubr</code> is a good example to continue with here.</p>
<div id="split-and-recombine-into-new-sections" class="section level3">
<h3>Split and recombine into new sections</h3>
<p>This book is internally broken into sections at arbitrary break points, hence why several sections begin in the middle of chapters, as seen above. Other chapters begin in the middle of sections. Use <code>epub_recombine</code> along with a regular expression that can match the true section breaks. This function collapses the full text and then rebuilds the text table using new sections with proper break points. In the process it also recalculates the numbers of words and characters and relabels the sections with chapter notation.</p>
<p>Fortunately, a reliable pattern exists, which consists of <code>CHAPTER</code> in capital letters followed by a space and some Roman numerals. Recombine the text into a new object.</p>
<pre class="r"><code>pat &lt;- &quot;CHAPTER [IVX]+&quot;
x2 &lt;- epub_recombine(x, pat)
x2
#&gt; # A tibble: 1 x 10
#&gt;   rights identifier creator title language subject date  source nchap data 
#&gt;   &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;  &lt;int&gt; &lt;lis&gt;
#&gt; 1 Publi~ http://ww~ Bram S~ Drac~ en       Horror~ 1995~ http:~    54 &lt;tib~

x2$data[[1]]
#&gt; # A tibble: 55 x 4
#&gt;    section text                                                 nword nchar
#&gt;    &lt;chr&gt;   &lt;chr&gt;                                                &lt;int&gt; &lt;int&gt;
#&gt;  1 prior   &quot;The Project Gutenberg EBook of Dracula, by Bram St~   159  1110
#&gt;  2 ch01    &quot;CHAPTER I\nPage\nJonathan Harker&#39;s Journal\n1\n&quot;        7    43
#&gt;  3 ch02    &quot;CHAPTER II\nJonathan Harker&#39;s Journal\n14\n&quot;            6    40
#&gt;  4 ch03    &quot;CHAPTER III\nJonathan Harker&#39;s Journal\n26\n&quot;           6    41
#&gt;  5 ch04    &quot;CHAPTER IV\nJonathan Harker&#39;s Journal\n38\n&quot;            6    40
#&gt;  6 ch05    &quot;CHAPTER V\nLetters-Lucy and Mina\n51\n&quot;                 6    35
#&gt;  7 ch06    &quot;CHAPTER VI\nMina Murray&#39;s Journal\n59\n&quot;                6    36
#&gt;  8 ch07    &quot;CHAPTER VII\nCutting from \&quot;The Dailygraph,\&quot; 8 Au~     9    55
#&gt;  9 ch08    &quot;CHAPTER VIII\nMina Murray&#39;s Journal\n84\n&quot;              6    38
#&gt; 10 ch09    &quot;CHAPTER IX\nMina Murray&#39;s Journal\n98\n&quot;                6    36
#&gt; # ... with 45 more rows</code></pre>
<p>But this is not quite as expected. There should be 27 chapters, not 54. What was not initially apparent was that the same pattern matching each chapter name also appears in the first section where every chapter is listed in the table of contents. The new section breaks were successful in keeping chapter text in single, unique sections, but there are now twice as many as needed. Unintentionally, the first 27 “chapters” represent the table of contents being split on each chapter ID. These should be removed.</p>
<p>An easy way to do this is with <code>epub_sift</code>, which sifts, or filters out, small word- or character-count sections from the nested data frame. It’s a simple sieve and you can control the size of the holes with <code>n</code>. You can choose <code>type = &quot;word&quot;</code> (default) or <code>type = &quot;character&quot;</code>. This is somewhat of a blunt instrument, but is useful in a circumstance like this one where it is clear it will work as desired.</p>
<pre class="r"><code>library(dplyr)
x2 &lt;- epub_recombine(x, pat) %&gt;% epub_sift(n = 200)
x2
#&gt; # A tibble: 1 x 10
#&gt;   rights identifier creator title language subject date  source nchap data 
#&gt;   &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;  &lt;int&gt; &lt;lis&gt;
#&gt; 1 Publi~ http://ww~ Bram S~ Drac~ en       Horror~ 1995~ http:~    54 &lt;tib~

x2$data[[1]]
#&gt; # A tibble: 27 x 4
#&gt;    section text                                                 nword nchar
#&gt;    &lt;chr&gt;   &lt;chr&gt;                                                &lt;int&gt; &lt;int&gt;
#&gt;  1 ch28    &quot;CHAPTER IJONATHAN HARKER&#39;S JOURNAL\n(Kept in short~  5694 30602
#&gt;  2 ch29    &quot;CHAPTER IIJONATHAN HARKER&#39;S JOURNAL-continued\n5 M~  5476 28462
#&gt;  3 ch30    &quot;CHAPTER IIIJONATHAN HARKER&#39;S JOURNAL-continued\nWH~  5703 29778
#&gt;  4 ch31    &quot;CHAPTER IVJONATHAN HARKER&#39;S JOURNAL-continued\nI A~  5828 30195
#&gt;  5 ch32    &quot;CHAPTER V\nLetter from Miss Mina Murray to Miss Lu~  3546 18004
#&gt;  6 ch33    &quot;CHAPTER VIMINA MURRAY&#39;S JOURNAL\n24 July. Whitby.-~  5654 29145
#&gt;  7 ch34    &quot;CHAPTER VIICUTTING FROM \&quot;THE DAILYGRAPH,\&quot; 8 AUGU~  5567 29912
#&gt;  8 ch35    &quot;CHAPTER VIIIMINA MURRAY&#39;S JOURNAL\nSame day, 11 o&#39;~  6267 32596
#&gt;  9 ch36    &quot;CHAPTER IX\nLetter, Mina Harker to Lucy Westenra.\~  5910 30129
#&gt; 10 ch37    &quot;CHAPTER X\nLetter, Dr. Seward to Hon. Arthur Holmw~  5932 30730
#&gt; # ... with 17 more rows</code></pre>
<p>This removes the unwanted rows, but one problem remains. Note that sifting the table sections in this case results in a need to re-apply <code>epub_recombine</code> because the sections we removed had nevertheless offset the chapter indexing. Another call to <code>epub_recombine</code> can be chained, but it may be more convenient to use the <code>sift</code> argument to <code>epub_recombine</code>, which is applied recursively.</p>
<pre class="r"><code># epub_recombine(x, pat) %&gt;% epub_sift(n = 200) %&gt;% epub_recombine(pat)
x2 &lt;- epub_recombine(x, pat, sift = list(n = 200))
x2
#&gt; # A tibble: 1 x 10
#&gt;   rights identifier creator title language subject date  source nchap data 
#&gt;   &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;  &lt;int&gt; &lt;lis&gt;
#&gt; 1 Publi~ http://ww~ Bram S~ Drac~ en       Horror~ 1995~ http:~    27 &lt;tib~

x2$data[[1]]
#&gt; # A tibble: 27 x 4
#&gt;    section text                                                 nword nchar
#&gt;    &lt;chr&gt;   &lt;chr&gt;                                                &lt;int&gt; &lt;int&gt;
#&gt;  1 ch01    &quot;CHAPTER IJONATHAN HARKER&#39;S JOURNAL\n(Kept in short~  5694 30602
#&gt;  2 ch02    &quot;CHAPTER IIJONATHAN HARKER&#39;S JOURNAL-continued\n5 M~  5476 28462
#&gt;  3 ch03    &quot;CHAPTER IIIJONATHAN HARKER&#39;S JOURNAL-continued\nWH~  5703 29778
#&gt;  4 ch04    &quot;CHAPTER IVJONATHAN HARKER&#39;S JOURNAL-continued\nI A~  5828 30195
#&gt;  5 ch05    &quot;CHAPTER V\nLetter from Miss Mina Murray to Miss Lu~  3546 18005
#&gt;  6 ch06    &quot;CHAPTER VIMINA MURRAY&#39;S JOURNAL\n24 July. Whitby.-~  5654 29145
#&gt;  7 ch07    &quot;CHAPTER VIICUTTING FROM \&quot;THE DAILYGRAPH,\&quot; 8 AUGU~  5567 29912
#&gt;  8 ch08    &quot;CHAPTER VIIIMINA MURRAY&#39;S JOURNAL\nSame day, 11 o&#39;~  6267 32596
#&gt;  9 ch09    &quot;CHAPTER IX\nLetter, Mina Harker to Lucy Westenra.\~  5910 30129
#&gt; 10 ch10    &quot;CHAPTER X\nLetter, Dr. Seward to Hon. Arthur Holmw~  5932 30730
#&gt; # ... with 17 more rows</code></pre>
</div>
<div id="reorder-sections-based-on-pattern-in-text" class="section level3">
<h3>Reorder sections based on pattern in text</h3>
<p>Some poorly formatted e-books have their internal sections occur in an arbitrary order. This can be frustrating to work with when doing text analysis on each section and where order matters. Just like recombining into new sections based on a pattern, sections that are out of order can be reordered based on a pattern. This requires a bit more work. In this case the user must provide a function that will map something in the matched pattern to an integer representing the desired row index.</p>
<p>Continue with the Dracula example, but with one difference. Even though the sections were originally broken at arbitrary points, they were in chronological order. To demonstrate the utility of <code>epub_reorder</code>, first randomize the rows so that chronological order can be recovered.</p>
<pre class="r"><code>set.seed(1)
x2$data[[1]] &lt;- sample_frac(x2$data[[1]])  # randomize rows for example
x2$data[[1]]
#&gt; # A tibble: 27 x 4
#&gt;    section text                                                 nword nchar
#&gt;    &lt;chr&gt;   &lt;chr&gt;                                                &lt;int&gt; &lt;int&gt;
#&gt;  1 ch08    &quot;CHAPTER VIIIMINA MURRAY&#39;S JOURNAL\nSame day, 11 o&#39;~  6267 32596
#&gt;  2 ch10    &quot;CHAPTER X\nLetter, Dr. Seward to Hon. Arthur Holmw~  5932 30730
#&gt;  3 ch15    &quot;CHAPTER XVDR. SEWARD&#39;S DIARY-continued.\nFOR a whi~  5803 29705
#&gt;  4 ch22    &quot;CHAPTER XXIIJONATHAN HARKER&#39;S JOURNAL\n3 October.-~  5450 28081
#&gt;  5 ch05    &quot;CHAPTER V\nLetter from Miss Mina Murray to Miss Lu~  3546 18005
#&gt;  6 ch20    &quot;CHAPTER XXJONATHAN HARKER&#39;S JOURNAL\n1 October, ev~  5890 31151
#&gt;  7 ch24    &quot;CHAPTER XXIVDR. SEWARD&#39;S PHONOGRAPH DIARY, SPOKEN ~  6272 32065
#&gt;  8 ch14    &quot;CHAPTER XIVMINA HARKER&#39;S JOURNAL\n23 September.-Jo~  6411 32530
#&gt;  9 ch12    &quot;CHAPTER XIIDR. SEWARD&#39;S DIARY\n18 September.-I dro~  7285 37868
#&gt; 10 ch02    &quot;CHAPTER IIJONATHAN HARKER&#39;S JOURNAL-continued\n5 M~  5476 28462
#&gt; # ... with 17 more rows</code></pre>
<p>It is clear above that sections are now out of order. It is common enough to load poorly formatted EPUB files and yield this type of result. If all you care about is the text in its entirely, this does not matter, but if your analysis involves trends over the course of a book, this is problematic.</p>
<p>For this book, you need a function that will convert an annoying Roman numeral to an integer. You already have the pattern for finding the relevant information in each text section. You only need to tweak it for proper substitution. Here is an example:</p>
<pre class="r"><code>f &lt;- function(x, pattern) as.numeric(as.roman(gsub(pattern, &quot;\\1&quot;, x)))</code></pre>
<p>This function is passed to <code>epub_reorder</code>. It takes and returns scalars. It must take two arguments: the first is a text string. The second is the regular expression. It must return a single number representing the index of that row. For example, if the pattern matches <code>CHAPTER IV</code>, the function should return a <code>4</code>.</p>
<p><code>epub_reorder</code> takes care of the rest. It applies your function to every row in the the nested data frame and then reorders the rows based on the full set of indices. Note that it also repeats this for every row (book) in the primary data frame, i.e., for every nested table. This means that the same function will be applied to every book. Therefore, you should only use this in bulk on a collection of e-books if you know the pattern does not change and the function will work correctly in each case.</p>
<p>The pattern has changed slightly. Parentheses are used to retain the important part of the matched pattern, the Roman numeral. The function <code>f</code> here substitutes the entire string (because now it begins with <code>^</code> and ends with <code>.*</code>) with only the part stored in parentheses (In <code>f</code>, this is the <code>\\1</code> substitution). <code>epub_reorder</code> applies this to all rows in the nested data frame:</p>
<pre class="r"><code>x2 &lt;- epub_reorder(x2, f, &quot;^CHAPTER ([IVX]+).*&quot;)
x2$data[[1]]
#&gt; # A tibble: 27 x 4
#&gt;    section text                                                 nword nchar
#&gt;    &lt;chr&gt;   &lt;chr&gt;                                                &lt;int&gt; &lt;int&gt;
#&gt;  1 ch01    &quot;CHAPTER IJONATHAN HARKER&#39;S JOURNAL\n(Kept in short~  5694 30602
#&gt;  2 ch02    &quot;CHAPTER IIJONATHAN HARKER&#39;S JOURNAL-continued\n5 M~  5476 28462
#&gt;  3 ch03    &quot;CHAPTER IIIJONATHAN HARKER&#39;S JOURNAL-continued\nWH~  5703 29778
#&gt;  4 ch04    &quot;CHAPTER IVJONATHAN HARKER&#39;S JOURNAL-continued\nI A~  5828 30195
#&gt;  5 ch05    &quot;CHAPTER V\nLetter from Miss Mina Murray to Miss Lu~  3546 18005
#&gt;  6 ch06    &quot;CHAPTER VIMINA MURRAY&#39;S JOURNAL\n24 July. Whitby.-~  5654 29145
#&gt;  7 ch07    &quot;CHAPTER VIICUTTING FROM \&quot;THE DAILYGRAPH,\&quot; 8 AUGU~  5567 29912
#&gt;  8 ch08    &quot;CHAPTER VIIIMINA MURRAY&#39;S JOURNAL\nSame day, 11 o&#39;~  6267 32596
#&gt;  9 ch09    &quot;CHAPTER IX\nLetter, Mina Harker to Lucy Westenra.\~  5910 30129
#&gt; 10 ch10    &quot;CHAPTER X\nLetter, Dr. Seward to Hon. Arthur Holmw~  5932 30730
#&gt; # ... with 17 more rows</code></pre>
<p>It is important that this is done on a nested data frame that has already been cleaned to the point of not containing extraneous rows that cannot be matched by the desired pattern. If they cannot be matched, then it is unknown where those rows should be placed relative to the others.</p>
<p>If sections are both out of order and use arbitrary break points, it would be necessary to reorder them before you split and recombine. If you split and recombine first, this would yield new sections that contain text from different parts of the e-book. However, the two are not likely to occur together; in fact it may be impossible for an EPUB file to be structured this way. In developing <code>epubr</code>, no such examples have been encountered. In any event, reordering out of order sections essentially requires a human-identifiable pattern near the beginning of each section text string, so it does not make sense to perform this operation unless the sections have meaningful break points.</p>
</div>
</div>
<div id="other-new-functions" class="section level2">
<h2>Other new functions</h2>
<div id="word-count" class="section level3">
<h3>Word count</h3>
<p>The helper function <code>count_words</code> provides word counts for strings, but allows you to control the regular expression patterns used for both splitting the string and conditionally counting the resulting character elements. This is the same function used internally by <code>epub</code> and <code>epub_recombine</code>. It is exported so that it can be used directly.</p>
<p>By default, <code>count_words</code> splits on spaces and new line characters. It counts as a word any element containing at least one alphanumeric character or the ampersand. It ignores everything else as noise, such as extra spaces, empty strings and isolated bits of punctuation.</p>
<pre class="r"><code>x &lt;- &quot; This   sentence will be counted to have:\n\n10 (ten) words.&quot;
count_words(x)
#&gt; [1] 10</code></pre>
</div>
<div id="inspection" class="section level3">
<h3>Inspection</h3>
<p>Helper functions for inspecting the text in the R console include <code>epub_head</code> and <code>epub_cat</code>.</p>
<p><code>epub_head</code> provides an overview of the text by section for each book in the primary data frame. The nested data frames are unnested and row bound to one another and returned as a single data frame. The text is shortened to only the first few characters (defaults to <code>n = 50</code>).</p>
<p><code>epub_cat</code> can be used to <code>cat</code> the text of an e-book to the console for quick inspection in a more readable form. It can take several arguments that help slice out a section of the text and customize how it is printed.</p>
<p>Both functions can take an EPUB filename or a data frame of an already loaded EPUB file as their first argument.</p>
</div>
</div>

    </div>
  </div>

</article>



<div class="article-container">
  <h3>Related</h3>
  <ul>
    
    <li><a href="../../post/epubr-0-5-0-cran-release/">epubr 0.5.0 CRAN release</a></li>
    
    <li><a href="../../post/epubr-0-4-0-cran-release/">epubr 0.4.0 CRAN release</a></li>
    
    <li><a href="../../post/my-2018-rstats-year-in-review/">My 2018 #rstats year in review</a></li>
    
    <li><a href="../../post/tiler-0-2-0-cran-release-create-map-tiles-from-r/">tiler 0.2.0 CRAN release: Create map tiles from R</a></li>
    
    <li><a href="../../post/apputils-0-5-0-released/">apputils 0.5.0 released</a></li>
    
  </ul>
</div>


<div class="container">
  <nav>
  <ul class="pager">
    
    <li class="previous"><a href="../../post/my-2018-rstats-year-in-review/"><span
      aria-hidden="true">&larr;</span> My 2018 #rstats year in review</a></li>
    

    
    <li class="next"><a href="../../post/tabr-0-3-0-on-cran/">tabr 0.3.0 on CRAN <span
      aria-hidden="true">&rarr;</span></a></li>
    
  </ul>
</nav>

</div>

<div class="article-container">
  

</div>

<footer class="site-footer">
  <div class="container">
    <p class="powered-by">

      &copy; Matthew Leonawicz &middot; 

      Powered by the <a href="https://github.com/gcushen/hugo-academic" target="_blank">Academic
      theme</a> for <a href="http://gohugo.io" target="_blank">Hugo</a>.

      <span class="pull-right" aria-hidden="true">
        <a href="#" id="back_to_top">
          <span class="button_icon">
            <i class="fa fa-chevron-up fa-2x"></i>
          </span>
        </a>
      </span>

    </p>
  </div>
</footer>

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js" integrity="sha512-jGsMH83oKe9asCpkOVkBnUrDDTp8wl+adkB2D+//JtlxO4SrLoJdhbOysIFQJloQFD+C4Fl1rMsQZF76JjV0eQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.2/imagesloaded.pkgd.min.js" integrity="sha512-iHzEu7GbSc705hE2skyH6/AlTpOfBmkx7nUqTLGzPYR+C1tRaItbRlJ7hT/D3YQ9SV0fqLKzp4XY9wKulTBGTw==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.19.1/TweenMax.min.js" integrity="sha512-Z5heTz36xTemt1TbtbfXtTq5lMfYnOkXM2/eWcTTiLU01+Sw4ku1i7vScDc8fWhrP2abz9GQzgKH5NGBLoYlAw==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.19.1/plugins/ScrollToPlugin.min.js" integrity="sha512-CDeU7pRtkPX6XJtF/gcFWlEwyaX7mcAp5sO3VIu/ylsdR74wEw4wmBpD5yYTrmMAiAboi9thyBUr1vXRPA7t0Q==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha512-iztkobsvnjKfAtTNdHkGVjAYTrrtlC7mGp/54c40wowO7LhURYl3gVzzcEqGl/qKXQltJ2HwMrdLcNUdo+N/RQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js" integrity="sha512-VDBOIlDbuC4VWxGJNmuFRQ0Li0SKkDpmGyuhAG5LTDLd/dJ/S0WMVxriR2Y+CyPL5gzjpN4f/6iqWVBJlht0tQ==" crossorigin="anonymous"></script>
    
    <script src="../../js/hugo-academic.js"></script>
    

    
    
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>

      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    

  </body>
</html>

